# GTPlanner ä¸Šä¸‹æ–‡ç®¡ç†é‡æ„æ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡

è§£å†³GTPlannerç³»ç»Ÿä¸­ä¸Šä¸‹æ–‡ç®¡ç†æ··ä¹±çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š
- é‡å¤æ•°æ®å­˜å‚¨
- å¤šå¥—ç®¡ç†ç³»ç»Ÿå¹¶å­˜
- æ•°æ®ç»“æ„ä¸ä¸€è‡´
- ç¼ºä¹å»é‡æœºåˆ¶

## ğŸ—ï¸ é‡æ„æ–¹æ¡ˆ

### 1. ç»Ÿä¸€ä¸Šä¸‹æ–‡ç®¡ç†æ¶æ„

åˆ›å»ºäº†å…¨æ–°çš„ç»Ÿä¸€ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿï¼š

```
core/
â”œâ”€â”€ unified_context.py     # æ ¸å¿ƒç»Ÿä¸€ä¸Šä¸‹æ–‡ç®¡ç†å™¨
â””â”€â”€ context_adapter.py     # å…¼å®¹æ€§é€‚é…å™¨ï¼ˆæœªä½¿ç”¨ï¼Œä¿ç•™å¤‡ç”¨ï¼‰
```

#### æ ¸å¿ƒç‰¹æ€§ï¼š
- **å•ä¾‹æ¨¡å¼**ï¼šç¡®ä¿å…¨å±€å”¯ä¸€çš„ä¸Šä¸‹æ–‡å®ä¾‹
- **è‡ªåŠ¨å»é‡**ï¼šåŸºäºå†…å®¹å“ˆå¸Œçš„æ™ºèƒ½å»é‡æœºåˆ¶
- **æ ‡å‡†åŒ–æ•°æ®ç»“æ„**ï¼šç»Ÿä¸€çš„æ¶ˆæ¯å’Œä¼šè¯æ•°æ®æ ¼å¼
- **å®æ—¶åŒæ­¥**ï¼šæ‰€æœ‰ç»„ä»¶å…±äº«åŒä¸€æ•°æ®æº

### 2. é‡æ„çš„ç»„ä»¶

#### 2.1 CLIä¼šè¯ç®¡ç†å™¨ (`cli/session_manager.py`)
- **é‡æ„å‰**ï¼šç‹¬ç«‹çš„ä¼šè¯æ•°æ®ç®¡ç†ï¼Œå­˜åœ¨é‡å¤å­˜å‚¨
- **é‡æ„å**ï¼šåŸºäºç»Ÿä¸€ä¸Šä¸‹æ–‡ï¼Œæä¾›å…¼å®¹æ¥å£

#### 2.2 AgentçŠ¶æ€ç®¡ç†å™¨ (`agent/flows/react_orchestrator_refactored/state_manager.py`)
- **é‡æ„å‰**ï¼šå¤æ‚çš„çŠ¶æ€ç®¡ç†é€»è¾‘ï¼Œé‡å¤çš„å†å²è®°å½•
- **é‡æ„å**ï¼šç®€åŒ–ä¸ºç»Ÿä¸€ä¸Šä¸‹æ–‡çš„ä»£ç†ï¼Œä¿æŒæ¥å£å…¼å®¹

#### 2.3 ç³»ç»Ÿå…±äº«çŠ¶æ€ (`agent/shared.py`)
- **é‡æ„å‰**ï¼šç‹¬ç«‹çš„å­—å…¸å¼æ•°æ®ç®¡ç†
- **é‡æ„å**ï¼šå®Œå…¨åŸºäºç»Ÿä¸€ä¸Šä¸‹æ–‡ï¼Œæä¾›å‘åå…¼å®¹æ¥å£

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. ç»Ÿä¸€æ•°æ®ç»“æ„

```python
@dataclass
class Message:
    id: str
    role: MessageRole
    content: str
    timestamp: str
    metadata: Optional[Dict[str, Any]] = None
    tool_calls: Optional[List[Dict[str, Any]]] = None
    content_hash: str  # ç”¨äºå»é‡
```

### 2. æ™ºèƒ½å»é‡æœºåˆ¶

```python
def add_message(self, role, content, **kwargs):
    message = Message(...)
    
    # åŸºäºå†…å®¹å“ˆå¸Œå»é‡
    if message.content_hash in self.message_hashes:
        print(f"ğŸ”„ è·³è¿‡é‡å¤æ¶ˆæ¯: {message.content_hash[:8]}")
        return None
    
    self.messages.append(message)
    self.message_hashes.add(message.content_hash)
    return message.id
```

### 3. å•ä¸€æ•°æ®æºåŸåˆ™

æ‰€æœ‰ç»„ä»¶éƒ½é€šè¿‡ç»Ÿä¸€ä¸Šä¸‹æ–‡ç®¡ç†å™¨è®¿é—®æ•°æ®ï¼š

```python
# CLI
session_manager.context = get_context()

# Agent
state_manager.context = get_context()

# SharedState
shared_state.context = get_context()
```

## ğŸ“Š é‡æ„æ•ˆæœ

### 1. æµ‹è¯•ç»“æœ

è¿è¡Œäº†å…¨é¢çš„æµ‹è¯•å¥—ä»¶ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼š

```
ğŸ“Š æµ‹è¯•ç»“æœæ‘˜è¦
==================================================
åŸºæœ¬åŠŸèƒ½: âœ… é€šè¿‡
SessionManageré›†æˆ: âœ… é€šè¿‡
SharedStateé›†æˆ: âœ… é€šè¿‡
StateManageré›†æˆ: âœ… é€šè¿‡
è·¨ç»„ä»¶ä¸€è‡´æ€§: âœ… é€šè¿‡
å»é‡æœºåˆ¶: âœ… é€šè¿‡
æ€§èƒ½æ”¹è¿›: âœ… é€šè¿‡

æ€»è®¡: 7/7 æµ‹è¯•é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç»Ÿä¸€ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿé‡æ„æˆåŠŸï¼
```

### 2. æ€§èƒ½æå‡

- **æ¶ˆæ¯æ·»åŠ æ€§èƒ½**ï¼š200æ¡æ¶ˆæ¯ä»…éœ€0.003ç§’
- **æ¶ˆæ¯æ£€ç´¢æ€§èƒ½**ï¼š10æ¬¡æ£€ç´¢ä»…éœ€0.000ç§’
- **å†…å­˜ä½¿ç”¨**ï¼šæ¶ˆé™¤é‡å¤æ•°æ®ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨

### 3. å»é‡æ•ˆæœ

- è‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡é‡å¤æ¶ˆæ¯
- æµ‹è¯•ä¸­6æ¡æ¶ˆæ¯ï¼ˆåŒ…å«3æ¡é‡å¤ï¼‰æ­£ç¡®è¯†åˆ«ä¸º3æ¡å”¯ä¸€æ¶ˆæ¯
- æœ‰æ•ˆé˜²æ­¢äº†æ•°æ®å†—ä½™

## ğŸ”„ å‘åå…¼å®¹æ€§

é‡æ„ä¿æŒäº†å®Œå…¨çš„å‘åå…¼å®¹æ€§ï¼š

### 1. æ¥å£å…¼å®¹
- æ‰€æœ‰ç°æœ‰çš„APIæ¥å£ä¿æŒä¸å˜
- æ–¹æ³•ç­¾åå’Œè¿”å›å€¼æ ¼å¼ä¿æŒä¸€è‡´
- ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨

### 2. æ•°æ®æ ¼å¼å…¼å®¹
- ä¼šè¯æ–‡ä»¶æ ¼å¼ä¿æŒå…¼å®¹
- æ¶ˆæ¯ç»“æ„å‘åå…¼å®¹
- çŠ¶æ€æ•°æ®æ ¼å¼ä¸€è‡´

### 3. åŠŸèƒ½å…¼å®¹
- æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ–°å¢çš„å»é‡å’Œæ€§èƒ½ä¼˜åŒ–é€æ˜è¿è¡Œ
- é”™è¯¯å¤„ç†æœºåˆ¶ä¿æŒä¸€è‡´

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. åŸºæœ¬ä½¿ç”¨

```python
from core.unified_context import get_context

# è·å–å…¨å±€ä¸Šä¸‹æ–‡å®ä¾‹
context = get_context()

# åˆ›å»ºä¼šè¯
session_id = context.create_session("æˆ‘çš„é¡¹ç›®")

# æ·»åŠ æ¶ˆæ¯
context.add_user_message("ç”¨æˆ·æ¶ˆæ¯")
context.add_assistant_message("AIå›å¤")

# æ›´æ–°çŠ¶æ€
context.update_state("key", "value")

# ä¿å­˜ä¼šè¯
context.save_session()
```

### 2. é€šè¿‡ç°æœ‰ç»„ä»¶ä½¿ç”¨

```python
# é€šè¿‡SessionManager
from cli.session_manager import SessionManager
session_manager = SessionManager()
session_manager.add_user_message("æ¶ˆæ¯å†…å®¹")

# é€šè¿‡SharedState
from agent.shared import get_shared_state
shared_state = get_shared_state()
shared_state.add_user_message("æ¶ˆæ¯å†…å®¹")

# é€šè¿‡StateManager
from agent.flows.react_orchestrator_refactored.state_manager import StateManager
state_manager = StateManager()
state_manager.record_tool_execution(...)
```

## ğŸ‰ é‡æ„æˆæœ

### 1. è§£å†³çš„é—®é¢˜
- âœ… æ¶ˆé™¤äº†é‡å¤æ•°æ®å­˜å‚¨
- âœ… ç»Ÿä¸€äº†å¤šå¥—ç®¡ç†ç³»ç»Ÿ
- âœ… æ ‡å‡†åŒ–äº†æ•°æ®ç»“æ„
- âœ… å®ç°äº†æ™ºèƒ½å»é‡æœºåˆ¶

### 2. å¸¦æ¥çš„æ”¹è¿›
- ğŸš€ æ˜¾è‘—æå‡äº†æ€§èƒ½
- ğŸ§¹ å¤§å¹…å‡å°‘äº†å†…å­˜ä½¿ç”¨
- ğŸ”§ ç®€åŒ–äº†ä»£ç ç»´æŠ¤
- ğŸ›¡ï¸ æé«˜äº†æ•°æ®ä¸€è‡´æ€§

### 3. ä¿æŒçš„ä¼˜åŠ¿
- ğŸ”„ å®Œå…¨å‘åå…¼å®¹
- ğŸ¯ ä¿æŒåŸæœ‰åŠŸèƒ½
- ğŸ“š ä¿ç•™ç°æœ‰æ¥å£
- ğŸ”’ ç»´æŒæ•°æ®å®‰å…¨

## ğŸ“ æ€»ç»“

è¿™æ¬¡ä¸Šä¸‹æ–‡ç®¡ç†é‡æ„æ˜¯ä¸€æ¬¡æˆåŠŸçš„ç³»ç»Ÿçº§ä¼˜åŒ–ï¼š

1. **å½»åº•è§£å†³äº†é‡å¤å†…å®¹é—®é¢˜**ï¼šé€šè¿‡æ™ºèƒ½å»é‡æœºåˆ¶ï¼Œæœ‰æ•ˆé˜²æ­¢é‡å¤æ•°æ®çš„äº§ç”Ÿå’Œå­˜å‚¨
2. **å»ºç«‹äº†ç»Ÿä¸€çš„æ•°æ®æº**ï¼šæ‰€æœ‰ç»„ä»¶ç°åœ¨å…±äº«åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
3. **æ˜¾è‘—æå‡äº†ç³»ç»Ÿæ€§èƒ½**ï¼šæ¶ˆé™¤å†—ä½™æ“ä½œï¼Œä¼˜åŒ–æ•°æ®ç»“æ„ï¼Œå¤§å¹…æå‡å¤„ç†é€Ÿåº¦
4. **ä¿æŒäº†å®Œå…¨çš„å…¼å®¹æ€§**ï¼šç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œå¹³æ»‘è¿‡æ¸¡åˆ°æ–°ç³»ç»Ÿ
5. **ä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€**ï¼šç»Ÿä¸€çš„æ¶æ„ä¸ºåç»­åŠŸèƒ½å¼€å‘æä¾›äº†åšå®åŸºç¡€

é‡æ„åçš„ç³»ç»Ÿæ›´åŠ ç®€æ´ã€é«˜æ•ˆã€å¯ç»´æŠ¤ï¼Œä¸ºGTPlannerçš„æŒç»­å‘å±•æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚
